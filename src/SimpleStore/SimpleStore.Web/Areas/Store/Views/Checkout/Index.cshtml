@using SimpleStore.Web.Areas.Store.ViewModels.Checkout
@model CheckoutViewModel
@{
    ViewData["Title"] = "Finalização da compra";
}

<div class="row">
    <div class="col">
        <div class="page-panel p-2 p-lg-3">
			<h3>Finalização da compra</h3>
			<div class="row">
				<div class="col">
					<h5 class="checkout-title">Endereço para entrega</h5>
					<div class="panel bg-light">
						<p>Selecione um endereço para entrega:</p>
						<form id="shipping-address-form" asp-controller="Checkout" asp-action="SelectShippingAddress">
							@if (Model.CustomerAddresses.Count > 0)
							{
								foreach(var address in Model.CustomerAddresses)
								{
									var selected = false;
									if (address.Id == Model.Cart.SelectedAddress)
									{
										selected = true;
									}
									<div class="form-check panel bg-white mt-2 d-flex align-items-center">
										<input type="radio" name="ShippingAddress" value="@address.Id" id="option-@address.Id" checked="@selected" onchange="this.form.submit();">
										<label class="form-check-label ms-2" for="option-@address.Id">
											<strong>@address.Responsible</strong><br />
											@address.ZipCode, @address.Address, @address.Number<br />
											@if (!string.IsNullOrWhiteSpace(address.Complement))
											{
												@address.Complement <br />
											}
											@address.Neighborhood, @address.City - @address.State<br />
										</label>
									</div>
								}
							}
						</form>
						<div class="form-check panel bg-white mt-2 d-flex align-items-center">
							<button class="btn btn-link">Cadastrar novo endereço</button>
						</div>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<h5 class="checkout-title">Forma de envio</h5>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<h5 class="checkout-title">Forma de Pagamento</h5>
					<div class="panel bg-light">
						<form id="payment-method-form" asp-controller="Checkout" asp-action="SelectPaymentMethod">
							@if (Model.PaymentMethods.Count > 0)
							{
								<p>Selecione sua forma de pagamento:</p>
								foreach(var option in Model.PaymentMethods)
								{
									<div class="form-check panel bg-white mt-2 d-flex align-items-center">
										<input type="radio" name="ShippingOption" value="@option.Identificator" id="option-@option.Identificator" checked="@option.Selected" onchange="this.form.submit();">
										<label class="form-check-label ms-2" for="option-@option.Identificator">
											@option.Name<br />
										</label>
									</div>
								}
							}
						</form>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col">
					<h5 class="checkout-title">Resumo e Finalização</h5>
				</div>
			</div>
            @if (Model.Cart.Items == null || Model.Cart.Items.Count == 0)
			{
				<h5>Carrinho vazio.</h5>
			}
			else
			{
				<div>
					<h5>Itens no carrinho</h5>
					<hr />
				</div>
				<div class="row">
					<div class="col-12">
						@foreach (var item in Model.Cart.Items)
						{
							<div class="cart-item col-12 d-flex">
								<div class="d-flex align-items-center">
									<form asp-controller="Cart" asp-action="RemoveItem">
										<input name="itemId" type="hidden" value="@item.CatalogItem.Id" />
										<button class="btn btn-light me-2 d-flex">
											<span class="iconify" data-icon="mdi:trash-outline" width="20" height="20"></span>
										</button>
									</form>
								</div>
								<div class="picture">
									<div class="square-box">
										<div class="square-content">
											<img src="@item.CatalogItem.Picture" />
										</div>
									</div>
								</div>
								<div class="cart-item-details ps-2">
									<h5>
										@item.CatalogItem.Name
									</h5>
									<p>@item.Quantity x <span class="price">@item.CatalogItem.PriceString</span></p>
								</div>
							</div>
						}
						<hr />
						<div class="col-12 mt-2">
							<a class="text-danger" href="/">Limpar carrinho</a>
						</div>
					</div>
					<div class="col-12">
						<div class="panel bg-light">
							<h5>Estimativa de entrega</h5>
							<form asp-controller="Cart" asp-action="EstimateShipping">
								<div class="row">
									<label class="col-auto col-form-label">
										CEP
									</label>
									<div class="col input-group">
										<input type="text" class="form-control" name="zipcode" value="@Model.Cart.ShippingZipCode" />
										<button class="btn btn-primary text-white">Calcular</button>
									</div>
								</div>
							</form>
							<form id="shipping-option-form" asp-controller="Cart" asp-action="SelectShippingOption">
								@if (Model.Cart.ShippingOptions.Count > 0)
								{
									<hr/>
									foreach(var option in Model.Cart.ShippingOptions)
									{
										<div class="form-check panel bg-white mt-2 d-flex align-items-center">
											<input type="radio" name="ShippingOption" value="@option.Id" id="option-@option.Id" checked="@option.Selected" onchange="this.form.submit();">
											<label class="form-check-label ms-2" for="option-@option.Id">
												@option.Name<br /> @option.ValueString
											</label>
										</div>
									}
								}
							</form>
						</div>
						<div class="panel bg-light mt-2">
							<h5>Resumo</h5>
							<div class="row">
								<div class="col-6">
									<span>Subtotal</span>
								</div>
								<div class="col-6 d-flex justify-content-end">
									<span>@Model.Cart.SubtotalString</span>
								</div>
							</div>
							<hr />
							<div class="row">
								<div class="col-6">
									<span>Frete</span>
								</div>
								<div class="col-6 d-flex justify-content-end">
									<span>@Model.Cart.ShippingValueString</span>
								</div>
							</div>
							<hr />
							<div class="row">
								<div class="col">
									<div class="panel bg-white">
										<div class="row">
											<div class="col-6">
												<span>Total</span>
											</div>
											<div class="col-6 d-flex justify-content-end">
												<span>@Model.Cart.TotalString</span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="d-flex justify-content-between mt-2">
							<a class="btn btn-secondary" href="/">Continuar comprando</a>
							<a class="btn btn-primary text-white" href="/Checkout">Finalizar compra</a>
						</div>
					</div>
				</div>
			}
        </div>
    </div>
</div>